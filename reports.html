{% extends "base.html" %}

{% block content %}
<!-- Reports Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h1><i class="fas fa-file-alt"></i> Laporan dan Analisis</h1>
            <div class="d-flex gap-2">
                <button class="btn btn-primary" onclick="generateReport()">
                    <i class="fas fa-plus"></i> Buat Laporan
                </button>
                <button class="btn btn-secondary" onclick="exportAllReports()">
                    <i class="fas fa-download"></i> Export Semua
                </button>
            </div>
        </div>
        <p class="lead">Analisis pertumbuhan dan perkembangan anak berdasarkan data yang tersedia</p>
    </div>
</div>

<!-- Report Types -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Jenis Laporan</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="card text-center report-type" onclick="selectReportType('growth')" style="cursor: pointer;">
                            <div class="card-body">
                                <i class="fas fa-chart-line" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 10px;"></i>
                                <h6>Pertumbuhan</h6>
                                <small class="text-muted">Analisis berat & tinggi</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-center report-type" onclick="selectReportType('development')" style="cursor: pointer;">
                            <div class="card-body">
                                <i class="fas fa-clipboard-check" style="font-size: 2rem; color: var(--secondary-color); margin-bottom: 10px;"></i>
                                <h6>Perkembangan</h6>
                                <small class="text-muted">Hasil KPSP & milestone</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-center report-type" onclick="selectReportType('nutrition')" style="cursor: pointer;">
                            <div class="card-body">
                                <i class="fas fa-utensils" style="font-size: 2rem; color: var(--success-color); margin-bottom: 10px;"></i>
                                <h6>Gizi</h6>
                                <small class="text-muted">Status gizi & MP-ASI</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-center report-type" onclick="selectReportType('comprehensive')" style="cursor: pointer;">
                            <div class="card-body">
                                <i class="fas fa-file-medical" style="font-size: 2rem; color: var(--info-color); margin-bottom: 10px;"></i>
                                <h6>Komprehensif</h6>
                                <small class="text-muted">Laporan lengkap</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Report Configuration -->
<div class="row mb-4" id="reportConfig" style="display: none;">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-cog"></i> Konfigurasi Laporan</h5>
            </div>
            <div class="card-body">
                <form id="reportForm">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="childName" class="form-label">Nama Anak</label>
                            <select class="form-select" id="childName">
                                <option value="all">Semua Anak</option>
                                <option value="aisyah">Aisyah Putri</option>
                                <option value="bintang">Bintang Pratama</option>
                                <option value="citra">Citra Lestari</option>
                                <option value="dimas">Dimas Aditya</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="dateRange" class="form-label">Periode</label>
                            <select class="form-select" id="dateRange">
                                <option value="1m">1 Bulan Terakhir</option>
                                <option value="3m">3 Bulan Terakhir</option>
                                <option value="6m">6 Bulan Terakhir</option>
                                <option value="1y">1 Tahun Terakhir</option>
                                <option value="all">Semua Data</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="reportFormat" class="form-label">Format</label>
                            <select class="form-select" id="reportFormat">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                                <option value="csv">CSV</option>
                                <option value="html">HTML</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Tambahkan ke Laporan:</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includeCharts" checked>
                                <label class="form-check-label" for="includeCharts">Grafik dan Chart</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includeRecommendations" checked>
                                <label class="form-check-label" for="includeRecommendations">Rekomendasi</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includeHistory" checked>
                                <label class="form-check-label" for="includeHistory">Riwayat Kesehatan</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includeMilestones" checked>
                                <label class="form-check-label" for="includeMilestones">Milestone Perkembangan</label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="additionalNotes" class="form-label">Catatan Tambahan</label>
                            <textarea class="form-control" id="additionalNotes" rows="4" placeholder="Masukkan catatan tambahan untuk laporan..."></textarea>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-primary" onclick="generateReport()">
                            <i class="fas fa-cog"></i> Generate Laporan
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="previewReport()">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="resetConfig()">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Report Preview -->
<div class="row mb-4" id="reportPreview" style="display: none;">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-file"></i> Preview Laporan</h5>
            </div>
            <div class="card-body">
                <div id="previewContent">
                    <!-- Preview content will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Generated Reports -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-folder"></i> Laporan yang Dihasilkan</h5>
                    <div class="d-flex gap-2">
                        <input type="text" class="form-control form-control-sm" placeholder="Cari laporan..." id="searchReports">
                        <button class="btn btn-sm btn-outline-primary" onclick="searchReports()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Nama Laporan</th>
                                <th>Tipe</th>
                                <th>Anak</th>
                                <th>Periode</th>
                                <th>Tanggal Dibuat</th>
                                <th>Ukuran</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTable">
                            <tr>
                                <td><i class="fas fa-file-pdf"></i> Laporan Pertumbuhan Aisyah</td>
                                <td><span class="badge bg-danger">PDF</span></td>
                                <td>Aisyah Putri</td>
                                <td>Jan - Mar 2024</td>
                                <td>2024-03-15 14:30</td>
                                <td>2.5 MB</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="viewReport('report1')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="downloadReport('report1')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteReport('report1')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-file-excel"></i> Analisis Gizi Komprehensif</td>
                                <td><span class="badge bg-success">Excel</span></td>
                                <td>Semua Anak</td>
                                <td>2024 Q1</td>
                                <td>2024-03-10 09:15</td>
                                <td>1.8 MB</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="viewReport('report2')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="downloadReport('report2')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteReport('report2')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-file-csv"></i> Data Perkembangan KPSP</td>
                                <td><span class="badge bg-primary">CSV</span></td>
                                <td>Bintang Pratama</td>
                                <td>Feb 2024</td>
                                <td>2024-02-28 16:45</td>
                                <td>0.5 MB</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="viewReport('report3')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="downloadReport('report3')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteReport('report3')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let selectedReportType = null;

    // Select report type
    function selectReportType(type) {
        selectedReportType = type;
        
        // Update UI
        document.querySelectorAll('.report-type').forEach(card => {
            card.classList.remove('border-primary');
        });
        event.target.closest('.report-type').classList.add('border-primary');
        
        // Show configuration
        document.getElementById('reportConfig').style.display = 'block';
        document.getElementById('reportConfig').scrollIntoView({ behavior: 'smooth' });
    }

    // Generate report
    function generateReport() {
        if (!selectedReportType) {
            alert('Pilih jenis laporan terlebih dahulu');
            return;
        }

        const formData = {
            childName: document.getElementById('childName').value,
            dateRange: document.getElementById('dateRange').value,
            reportFormat: document.getElementById('reportFormat').value,
            includeCharts: document.getElementById('includeCharts').checked,
            includeRecommendations: document.getElementById('includeRecommendations').checked,
            includeHistory: document.getElementById('includeHistory').checked,
            includeMilestones: document.getElementById('includeMilestones').checked,
            additionalNotes: document.getElementById('additionalNotes').value
        };

        showLoading();
        
        setTimeout(() => {
            hideLoading();
            alert(`Laporan ${selectedReportType} berhasil dibuat!`);
            
            // Add to reports table
            addToReportsTable(formData);
            
            // Reset form
            resetConfig();
        }, 2000);
    }

    // Preview report
    function previewReport() {
        if (!selectedReportType) {
            alert('Pilih jenis laporan terlebih dahulu');
            return;
        }

        const previewContent = `
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5>Preview Laporan ${selectedReportType.charAt(0).toUpperCase() + selectedReportType.slice(1)}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Informasi Umum</h6>
                            <ul>
                                <li>Nama Anak: ${document.getElementById('childName').value}</li>
                                <li>Periode: ${document.getElementById('dateRange').value}</li>
                                <li>Format: ${document.getElementById('reportFormat').value.toUpperCase()}</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Konten Laporan</h6>
                            <ul>
                                ${document.getElementById('includeCharts').checked ? '<li>Grafik dan Chart</li>' : ''}
                                ${document.getElementById('includeRecommendations').checked ? '<li>Rekomendasi</li>' : ''}
                                ${document.getElementById('includeHistory').checked ? '<li>Riwayat Kesehatan</li>' : ''}
                                ${document.getElementById('includeMilestones').checked ? '<li>Milestone Perkembangan</li>' : ''}
                            </ul>
                        </div>
                    </div>
                    <div class="mt-3">
                        <h6>Preview Grafik</h6>
                        <canvas id="previewChart" width="400" height="200" style="background: #f8f9fa;"></canvas>
                    </div>
                </div>
            </div>
        `;
        
        document.getElementById('previewContent').innerHTML = previewContent;
        document.getElementById('reportPreview').style.display = 'block';
        document.getElementById('reportPreview').scrollIntoView({ behavior: 'smooth' });
    }

    // Reset configuration
    function resetConfig() {
        document.getElementById('reportForm').reset();
        document.getElementById('reportConfig').style.display = 'none';
        document.getElementById('reportPreview').style.display = 'none';
        document.querySelectorAll('.report-type').forEach(card => {
            card.classList.remove('border-primary');
        });
        selectedReportType = null;
    }

    // Add to reports table
    function addToReportsTable(formData) {
        const table = document.getElementById('reportsTable');
        const newRow = table.insertRow(0);
        
        const reportId = 'report_' + Date.now();
        const now = new Date();
        const timestamp = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
        
        newRow.innerHTML = `
            <td><i class="fas fa-file-${formData.reportFormat}"></i> Laporan ${selectedReportType} Baru</td>
            <td><span class="badge bg-${formData.reportFormat === 'pdf' ? 'danger' : formData.reportFormat === 'excel' ? 'success' : 'primary'}">${formData.reportFormat.toUpperCase()}</span></td>
            <td>${formData.childName}</td>
            <td>${formData.dateRange}</td>
            <td>${timestamp}</td>
            <td>1.2 MB</td>
            <td>
                <button class="btn btn-sm btn-primary" onclick="viewReport('${reportId}')">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-sm btn-secondary" onclick="downloadReport('${reportId}')">
                    <i class="fas fa-download"></i>
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteReport('${reportId}')">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
    }

    // Search reports
    function searchReports() {
        const searchTerm = document.getElementById('searchReports').value.toLowerCase();
        const rows = document.querySelectorAll('#reportsTable tr');
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    // View report
    function viewReport(reportId) {
        alert(`Menampilkan laporan: ${reportId}`);
    }

    // Download report
    function downloadReport(reportId) {
        alert(`Mengunduh laporan: ${reportId}`);
    }

    // Delete report
    function deleteReport(reportId) {
        if (confirm('Apakah Anda yakin ingin menghapus laporan ini?')) {
            alert(`Laporan ${reportId} berhasil dihapus`);
        }
    }

    // Export all reports
    function exportAllReports() {
        alert('Mengekspor semua laporan...');
    }
</script>
{% endblock %}